<?php//Added include("includes/footer.php")and removed fixed sizes of club_name and contestant_name global $class_gender, $contestant_result, $contestant_height, $contestant_result, $contestant_gender, $sql_db;//Access level top administrator$MM_authorizedUsers = "1";$MM_donotCheckaccess = "false";$pagetitle="T&auml;vlande i klassen - admin";$pagedescription="Tuna Karate Cup som arrangeras av Eskilstuna Karateklubb i Eskilstuna Sporthall.";$pagekeywords="tuna karate cup, hantera tävlande i klassen, karate, eskilstuna, sporthallen, wado, självförsvar, kampsport, budo, karateklubb, sverige, idrott, sport, kamp";// Includes HTML Head, and several other code functionsinclude_once('includes/functions.php');$editFormAction = $_SERVER['PHP_SELF'];if (isset($_SERVER['QUERY_STRING'])) {$editFormAction .= "?" . htmlentities($_SERVER['QUERY_STRING']);}// Delete the selected registration when clicking the buttonif ((isset($_POST["MM_delete"])) && ($_POST["MM_delete"] == "delete_reg")) {$deleteSQL = sprintf("DELETE FROM registration WHERE reg_id=%s",		   GetSQLValueString($_POST['reg_id'], "int"));mysql_select_db($database_DBconnection, $DBconnection);$Result1 = mysql_query($deleteSQL, $DBconnection) or die(mysql_error());}?><!-- Include top navigation links, News and sponsor sections --><?php include("includes/header.php");?> <!-- start page --><div id="pageName"><h1><?php echo $pagetitle?></h1></div><!-- Include different navigation links depending on authority  --><div id="localNav"><?php include("includes/navigation.php"); ?></div><div id="content">        <div class="feature">           <div class="error"><?php// If the update form is sent (button clicked), validation will startif ((isset($_POST["MM_update"])) && ($_POST["MM_update"] == "update_reg")) {   $colname_rsClass = $_POST['class'];   //Select Class gender for selected class   mysql_select_db($database_DBconnection, $DBconnection);   $query_rsClassGender = sprintf("SELECT class_gender FROM classes WHERE class_id = %s", GetSQLValueString($colname_rsClass, "int"));   $rsClassGender = mysql_query($query_rsClassGender, $DBconnection) or die(mysql_error());   $row_rsClassGender = mysql_fetch_assoc($rsClassGender);               $class_gender = $row_rsClassGender['class_gender'];   $contestant_result = $_POST['contestant_result'];   $contestant_height = $_POST['contestant_height'];   $contestant_gender = $_POST['contestant_gender'];   $sql_db = 'yes';        // Check if input is numeric, if $contestant_height is entered	    	if (!empty($contestant_height)) {	    		if (!ctype_digit($contestant_height)) {	      		// contestant_height input is not numeric      		echo '<h3>Bara siffror &auml;r till&aring;tet i f&auml;ltet f&ouml;r l&auml;ngd!</h3>';      		$sql_db = 'no';	    	}    	}             // Check if input is numeric, if $contestant_result is entered	    	if (!empty($contestant_result)) {	    		if (!ctype_digit($contestant_result)) {	      		// $contestant_result input is not numeric      		echo '<h3>Bara siffror &auml;r till&aring;tet i f&auml;ltet f&ouml;r resultat!</h3>';      		$sql_db = 'no';	    	}    	}             if ($class_gender <> $contestant_gender ) {	      	// Compare $contestant_gender with $class_gender      	echo '<h3>T&auml;vlandes k&ouml;n st&auml;mmer inte &ouml;verens med den valda klassen!</h3>';      	$sql_db = 'no';	} /*  	else {        $sql_db = 'no';  	} */mysql_free_result($rsClassGender);}				//Save the updated information   	if ($sql_db == 'yes') {	// Update the registration in accordance with the input from the update form, regarding class and result for the contestant when clicking the button and if the form is validated ok	$updateSQL = sprintf("UPDATE registration SET contestant_result=%s, contestant_height=%s, class_id=%s WHERE reg_id=%s",		   GetSQLValueString($_POST['contestant_result'], "int"),		   GetSQLValueString($_POST['contestant_height'], "int"),		   GetSQLValueString($_POST['class'], "int"),		   GetSQLValueString($_POST['reg_id'], "int"));	mysql_select_db($database_DBconnection, $DBconnection);	$Result1 = mysql_query($updateSQL, $DBconnection) or die(mysql_error());	}	// Select the contestants and their information for the selected class$colname_rsRegistrations = "-1";if (isset($_GET['class_id'])) {$colname_rsRegistrations = $_GET['class_id'];}mysql_select_db($database_DBconnection, $DBconnection);$query_rsRegistrations = sprintf("SELECT a.club_name, re.reg_id, re.contestant_result, re.contestant_height, co.contestant_name, co.contestant_gender, cl.class_id, cl.class_category, cl.class_discipline, cl.class_gender, cl.class_gender_category, cl.class_weight_length, cl.class_age FROM registration AS re INNER JOIN classes AS cl USING (class_id) INNER JOIN contestants AS co USING (contestant_id) INNER JOIN account AS a USING (account_id) INNER JOIN clubregistration AS clu USING (club_reg_id) WHERE cl.class_id = %s ORDER BY club_startorder, reg_id", GetSQLValueString($colname_rsRegistrations, "int"));$rsRegistrations = mysql_query($query_rsRegistrations, $DBconnection) or die(mysql_error());$row_rsRegistrations = mysql_fetch_assoc($rsRegistrations);$totalRows_rsRegistrations = mysql_num_rows($rsRegistrations);// Select all classes for the current competitionmysql_select_db($database_DBconnection, $DBconnection);$query_rsClasses = "SELECT cl.class_id, cl.comp_id, cl.class_category, cl.class_discipline, cl.class_gender, cl.class_gender_category,cl.class_weight_length, cl.class_age FROM classes AS cl JOIN competition AS co ON cl.comp_id = co.comp_id WHERE co.comp_current = 1 ORDER BY cl.class_discipline, cl.class_gender, cl.class_age, cl.class_weight_length, cl.class_gender_category";$rsClasses = mysql_query($query_rsClasses, $DBconnection) or die(mysql_error());$row_rsClasses = mysql_fetch_assoc($rsClasses);$totalRows_rsClasses = mysql_num_rows($rsClasses);?>        </div><?php if ($totalRows_rsRegistrations == 0) { // Show if recordset empty ?><h3>Det finns ingen t&auml;vlande i klassen!</h3><p><a href="ClassesList.php">Tillbaka till T&auml;vlingsklasser</a></p><?php } // Show if recordset empty if ($totalRows_rsRegistrations > 0) { // Show if recordset not empty ?><p>&Auml;ndra t&auml;vlingsklass, l&auml;ngd eller placering och klicka p&aring; Spara eller ta bort anm&auml;lan.</p><h3><?php     echo $row_rsRegistrations['class_discipline'].' | '.$row_rsRegistrations['class_gender_category'].' | '.$row_rsRegistrations['class_category'];if ($row_rsRegistrations['class_age'] == "") {         echo ""; } if ($row_rsRegistrations['class_age'] <> "") {     echo ' | '.$row_rsRegistrations['class_age'].' &aring;r'.'  ';     }if ($row_rsRegistrations['class_weight_length'] == "") {     echo "";     } if ($row_rsRegistrations['class_weight_length'] <> "") { echo ' | '.$row_rsRegistrations['class_weight_length'];}?></h3><table width ="100%" border="1"><tr><td>    <strong>T&auml;vlingsklass - Klubb - T&auml;vlande - L&auml;ngd (eventuellt) - Placering - Spara - Ta bort anm&auml;lan</strong></td></tr><tr><td><table width ="100%" ><?php do { ?><tr><form action="<?php echo $editFormAction; ?>" method="POST" enctype="application/x-www-form-urlencoded" name="update_reg" id="update_reg"><td><select name="class" id="class"><?phpdo {  ?><option value="<?php echo $row_rsClasses['class_id']?>"<?php if (!(strcmp($row_rsClasses['class_id'], $colname_rsRegistrations))) {echo "selected=\"selected\"";} ?>><?php echo $row_rsClasses['class_discipline'].' | '.$row_rsClasses['class_gender_category'].' | '.$row_rsClasses['class_weight_length'].' | '.$row_rsClasses['class_age'].' &aring;r'?></option><?php} while ($row_rsClasses = mysql_fetch_assoc($rsClasses));$rows = mysql_num_rows($rsClasses);if($rows > 0) {mysql_data_seek($rsClasses, 0);$row_rsClasses = mysql_fetch_assoc($rsClasses);}?></select></label></td><td>    <label><input name="club_name" type="text" id="club_name" value="<?php echo $row_rsRegistrations['club_name']; ?>" readonly="readonly"/></label></td><td>    <label><input name="contestant_name" type="text" id="contestant_name" value="<?php echo $row_rsRegistrations['contestant_name']; ?>" readonly="readonly"/></label></td><td>    <label><input name="contestant_height" type="text" id="contestant_height" value="<?php echo $row_rsRegistrations['contestant_height']; ?>" size="1" maxlength="3" /></label><td>    <label><input name="contestant_result" type="id" id="contestant_result" value="<?php echo $row_rsRegistrations['contestant_result']; ?>" size="1" /></label></td><td>    <?php if ($row_rsRegistrations['contestant_result'] == "") { echo ''; }?><?php if ($row_rsRegistrations['contestant_result'] <> "") { echo ':a'; } ?></td><td>    <label><input type="submit" name="update_reg" id="update_reg" value="Spara" /></label></td><input name="reg_id" type="hidden" id="reg_id" value="<?php echo $row_rsRegistrations['reg_id']; ?>" /><input type="hidden" name="MM_update" value="update_reg" /><input type="hidden" name="contestant_gender" id="contestant_gender" value="<?php echo $row_rsRegistrations['contestant_gender']; ?>" /></form></td>	<form action="<?php echo $editFormAction; ?>" method="POST" enctype="application/x-www-form-urlencoded" name="delete_reg" id="delete_reg">    <td>        <label><input type="submit" name="delete_reg" id="delete_reg" value="Ta bort" /></label>    </td>    <input name="reg_id" type="hidden" id="reg_id" value="<?php echo $row_rsRegistrations['reg_id']; ?>" />    <input type="hidden" name="MM_delete" value="delete_reg" />    </form></tr><?php } while ($row_rsRegistrations = mysql_fetch_assoc($rsRegistrations)); ?></table></td></tr></table><?php // Show if recordset not empty } ?>    </div></div><?php include("includes/footer.php");?></body></html><?phpmysql_free_result($rsRegistrations);mysql_free_result($rsClasses);?>